{% extends 'base.html' %}
{% load static %}

{% block title %}Habits - TaskForge{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/habits.css' %}">
{% endblock %}

{% block content %}
<div class="habits-page">
    <!-- Заголовок сторінки -->
    <div class="page-header">
        <h1>My Habits</h1>
        <p>Build positive habits and track your daily progress</p>
    </div>

    <!-- Статистика привычек -->
    <div class="habits-stats">
        <div class="stat-card">
            <div class="stat-number">{{ total_habits }}</div>
            <div class="stat-label">Total Habits</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ active_habits }}</div>
            <div class="stat-label">Active Habits</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ completed_today }}</div>
            <div class="stat-label">Done Today</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ current_streak }}</div>
            <div class="stat-label">Current Streak</div>
        </div>
    </div>

    <!-- Основний контент -->
    <div class="habits-content">
        <!-- Ліва колонка - список привычек -->
        <div class="habits-list-section">
            <div class="section-header">
                <h2>Your Habits</h2>
                <button class="btn-primary" id="create-habit-btn">
                    <i class="fas fa-plus"></i> Create Habit
                </button>
            </div>

            {% if user_habits %}
                <div class="habits-list">
                    {% for habit in user_habits %}
                        <div class="habit-card {% if not habit.active %}inactive{% endif %}" data-habit-id="{{ habit.id }}">
                            <div class="habit-header">
                                <div class="habit-info">
                                    <h3>{{ habit.name }}</h3>
                                    <div class="habit-frequency">{{ habit.get_frequency_display }}</div>
                                </div>
                                <div class="habit-actions">
                                    <button class="btn-icon toggle-habit-btn" data-habit-id="{{ habit.id }}" title="{% if habit.active %}Deactivate{% else %}Activate{% endif %} Habit">
                                        <i class="fas {% if habit.active %}fa-pause{% else %}fa-play{% endif %}"></i>
                                    </button>
                                    <button class="btn-icon delete-habit-btn" data-habit-id="{{ habit.id }}" title="Delete Habit">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            {% if habit.description %}
                                <p class="habit-description">{{ habit.description }}</p>
                            {% endif %}

                            <!-- Чекин на сегодня -->
                            <div class="habit-checkin-section">
                                <div class="checkin-header">
                                    <span>Today's Progress</span>
                                    <span class="checkin-date">{{ today|date:"F d" }}</span>
                                </div>
                                <div class="checkin-controls">
                                    <button class="btn-checkin {% if habit.is_checked_today %}checked{% endif %}" 
                                            data-habit-id="{{ habit.id }}"
                                            {% if not habit.active %}disabled{% endif %}>
                                        <i class="fas{% if habit.is_checked_today %} fa-check-circle{% else %} fa-circle{% endif %}"></i>
                                        {% if habit.is_checked_today %}Completed{% else %}Mark as Done{% endif %}
                                    </button>
                                </div>
                            </div>

                            <!-- Статистика привычки -->
                            <div class="habit-stats">
                                <div class="stat-item">
                                    <div class="stat-value">{{ habit.current_streak }}</div>
                                    <div class="stat-label">Current Streak</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">{{ habit.longest_streak }}</div>
                                    <div class="stat-label">Best Streak</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">{{ habit.completion_rate }}%</div>
                                    <div class="stat-label">Success Rate</div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-seedling"></i>
                    </div>
                    <h3>No Habits Yet</h3>
                    <p>Start building positive habits today!</p>
                    <button class="btn-primary" id="create-first-habit-btn">
                        <i class="fas fa-plus"></i> Create Your First Habit
                    </button>
                </div>
            {% endif %}
        </div>

        <!-- Права колонка - створення привычек і шаблони -->
        <div class="habits-sidebar">
            <!-- Форма створення привычки -->
            <div class="create-habit-section" id="create-habit-section" style="display: none;">
                <h3>Create New Habit</h3>
                <form id="create-habit-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="habit-name">Habit Name*</label>
                        <input type="text" id="habit-name" name="name" required placeholder="Enter habit name">
                    </div>
                    
                    <div class="form-group">
                        <label for="habit-description">Description</label>
                        <textarea id="habit-description" name="description" placeholder="Describe your habit..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="habit-frequency">Frequency*</label>
                        <select id="habit-frequency" name="frequency" required>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="cancel-habit-btn">Cancel</button>
                        <button type="submit" class="btn-primary">Create Habit</button>
                    </div>
                </form>
            </div>

            <!-- Шаблони привычек -->
            {% if habit_templates %}
                <div class="habit-templates-section">
                    <h3>Habit Templates</h3>
                    <p>Quick start with proven habits</p>
                    
                    <div class="templates-list">
                        {% for template in habit_templates %}
                            <div class="template-card">
                                <h4>{{ template.name }}</h4>
                                {% if template.description %}
                                    <p>{{ template.description|truncatechars:100 }}</p>
                                {% endif %}
                                <div class="template-meta">
                                    <span class="template-frequency">{{ template.get_frequency_display }}</span>
                                    {% if template.category %}
                                        <span class="template-category">{{ template.get_category_display }}</span>
                                    {% endif %}
                                </div>
                                <button class="btn-primary use-template-btn" data-template-id="{{ template.id }}">
                                    Use Template
                                </button>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Модальное вікно підтвердження видалення -->
<div id="delete-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Delete Habit</h2>
        <p>Are you sure you want to delete this habit? This action cannot be undone.</p>
        <div class="modal-actions">
            <button class="btn-secondary" id="cancel-delete">Cancel</button>
            <button class="btn-danger" id="confirm-delete">Delete</button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/pages/habits.js' %}"></script>
{% endblock %}